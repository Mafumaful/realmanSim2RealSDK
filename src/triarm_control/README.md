# triarm_control

ä¸‰è‡‚æœºå™¨äººå…³èŠ‚æŽ§åˆ¶ROS2åŠŸèƒ½åŒ…

## æ¦‚è¿°

`triarm_control` æ˜¯ä¸€ä¸ªç”¨äºŽæŽ§åˆ¶ä¸‰è‡‚æœºå™¨äººå¹³å°çš„ROS2åŠŸèƒ½åŒ…ï¼Œæä¾›å›¾å½¢åŒ–ç•Œé¢ï¼ˆGUIï¼‰æ¥å®žæ—¶ç›‘æŽ§å’ŒæŽ§åˆ¶19ä¸ªå…³èŠ‚çš„è¿åŠ¨ã€‚è¯¥åŠŸèƒ½åŒ…æ”¯æŒä¸ŽIsaac Simä»¿çœŸçŽ¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œå®žçŽ°å¹³æ»‘çš„å…³èŠ‚è¿åŠ¨æŽ§åˆ¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å›¾å½¢åŒ–æŽ§åˆ¶ç•Œé¢**ï¼šåŸºäºŽTkinterçš„ç›´è§‚GUIï¼Œåˆ†æ ‡ç­¾é¡µæ˜¾ç¤ºä¸åŒæœºæ¢°è‡‚
- âœ… **å®žæ—¶çŠ¶æ€ç›‘æŽ§**ï¼šæ˜¾ç¤ºæ¥è‡ªIsaac Simçš„å®žæ—¶å…³èŠ‚ä½ç½®åé¦ˆ
- âœ… **åŒé‡æ˜¾ç¤º**ï¼šåŒæ—¶æ˜¾ç¤ºå®žæ—¶å€¼ï¼ˆè“è‰²ï¼‰å’ŒæŒ‡ä»¤å€¼ï¼ˆç»¿è‰²ï¼‰
- âœ… **å¹³æ»‘è¿åŠ¨æŽ§åˆ¶**ï¼šåŸºäºŽé€Ÿåº¦é™åˆ¶çš„æ’å€¼ç®—æ³•ï¼Œé¿å…çªå˜
- âœ… **å®‰å…¨é™ä½ä¿æŠ¤**ï¼šæ¯ä¸ªå…³èŠ‚éƒ½æœ‰ç¡¬ç¼–ç çš„è§’åº¦é™ä½
- âœ… **çµæ´»è¾“å…¥æ–¹å¼**ï¼šæ”¯æŒæ»‘å—å’Œæ–‡æœ¬æ¡†ä¸¤ç§è¾“å…¥æ–¹å¼
- âœ… **å…³èŠ‚åç§°åŒ¹é…**ï¼šè‡ªåŠ¨åŒ¹é…å…³èŠ‚åç§°ï¼Œé¿å…é¡ºåºé”™ä¹±

## ç³»ç»Ÿæž¶æž„

### æœºå™¨äººé…ç½®

- **æ€»å…³èŠ‚æ•°**ï¼š19ä¸ª
- **å¹³å°å…³èŠ‚**ï¼š1ä¸ªæ—‹è½¬å…³èŠ‚ï¼ˆD1ï¼‰
- **æœºæ¢°è‡‚A**ï¼š6è‡ªç”±åº¦ï¼ˆA1-A6ï¼‰
- **æœºæ¢°è‡‚B**ï¼š6è‡ªç”±åº¦ï¼ˆB1-B6ï¼‰
- **æœºæ¢°è‡‚S**ï¼š6è‡ªç”±åº¦ï¼ˆS1-S6ï¼‰

### ROS2é€šä¿¡

**è®¢é˜…è¯é¢˜**ï¼š
- `/joint_states` (æˆ– `{namespace}/joint_states`)
  - æ¶ˆæ¯ç±»åž‹ï¼š`sensor_msgs/JointState`
  - åŠŸèƒ½ï¼šæŽ¥æ”¶æ¥è‡ªIsaac Simçš„å®žæ—¶å…³èŠ‚ä½ç½®

**å‘å¸ƒè¯é¢˜**ï¼š
- `/joint_command` (æˆ– `{namespace}/joint_command`)
  - æ¶ˆæ¯ç±»åž‹ï¼š`sensor_msgs/JointState`
  - åŠŸèƒ½ï¼šå‘é€ç›®æ ‡å…³èŠ‚ä½ç½®æŒ‡ä»¤
  - é¢‘çŽ‡ï¼š50 Hzï¼ˆå¯é…ç½®ï¼‰

## å®‰è£…ä¾èµ–

```bash
# å®‰è£…Pythonä¾èµ–
sudo apt-get install python3-tk

# å®‰è£…ROS2ä¾èµ–
sudo apt-get install ros-${ROS_DISTRO}-sensor-msgs
```

## ç¼–è¯‘

```bash
cd /root/code/realmanSim2RealSDK
colcon build --packages-select triarm_control
source install/setup.bash
```

## ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨æŽ§åˆ¶èŠ‚ç‚¹

```bash
ros2 launch triarm_control triarm_control.launch.py
```

### ç›´æŽ¥è¿è¡ŒèŠ‚ç‚¹ï¼ˆä¸ä½¿ç”¨launchæ–‡ä»¶ï¼‰

```bash
ros2 run triarm_control joint_gui
```

### è‡ªå®šä¹‰å‚æ•°å¯åŠ¨

```bash
ros2 run triarm_control joint_gui --ros-args \
  -p namespace:=robot \
  -p gui_width:=800 \
  -p gui_height:=600 \
  -p joint_velocity:=45.0 \
  -p publish_rate:=100.0
```

## é…ç½®å‚æ•°

é…ç½®æ–‡ä»¶ä½ç½®ï¼š`config/triarm_config.yaml`

| å‚æ•°åç§° | ç±»åž‹ | é»˜è®¤å€¼ | è¯´æ˜Ž |
|---------|------|--------|------|
| `namespace` | string | `"robot"` | ROSè¯é¢˜å‘½åç©ºé—´ |
| `gui_width` | int | `700` | GUIçª—å£å®½åº¦ï¼ˆåƒç´ ï¼‰ |
| `gui_height` | int | `500` | GUIçª—å£é«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| `joint_velocity` | float | `30.0` | å…³èŠ‚è¿åŠ¨é€Ÿåº¦ï¼ˆåº¦/ç§’ï¼‰ |
| `publish_rate` | float | `50.0` | æŒ‡ä»¤å‘å¸ƒé¢‘çŽ‡ï¼ˆHzï¼‰ |

## GUIç•Œé¢è¯´æ˜Ž

### ç•Œé¢å¸ƒå±€

GUIé‡‡ç”¨æ ‡ç­¾é¡µè®¾è®¡ï¼Œåˆ†ä¸º4ä¸ªæ ‡ç­¾é¡µï¼š
- **å¹³å°**ï¼šæŽ§åˆ¶å¹³å°æ—‹è½¬å…³èŠ‚ï¼ˆD1ï¼‰
- **æœºæ¢°è‡‚A**ï¼šæŽ§åˆ¶A1-A6å…³èŠ‚
- **æœºæ¢°è‡‚B**ï¼šæŽ§åˆ¶B1-B6å…³èŠ‚
- **æœºæ¢°è‡‚S**ï¼šæŽ§åˆ¶S1-S6å…³èŠ‚

### æ˜¾ç¤ºè¯´æ˜Ž

æ¯ä¸ªå…³èŠ‚è¡ŒåŒ…å«ä»¥ä¸‹å…ƒç´ ï¼š

| åˆ— | è¯´æ˜Ž |
|----|------|
| **å…³èŠ‚** | å…³èŠ‚ç¼–å·ï¼ˆå¦‚D1, A1, B2ç­‰ï¼‰ |
| **å®žæ—¶å€¼**ï¼ˆè“è‰²ï¼‰ | æ¥è‡ªIsaac Simçš„å½“å‰å®žé™…ä½ç½® |
| **æŒ‡ä»¤å€¼**ï¼ˆç»¿è‰²ï¼‰ | æ­£åœ¨å‘é€ç»™æœºå™¨äººçš„ç›®æ ‡ä½ç½® |
| **æ»‘å—æŽ§åˆ¶** | å¯è§†åŒ–è°ƒèŠ‚ç›®æ ‡è§’åº¦ |
| **ç›®æ ‡è§’åº¦** | ç²¾ç¡®æ•°å€¼è¾“å…¥æ¡† |

### æŽ§åˆ¶æŒ‰é’®

- **æ‰§è¡Œ**ï¼šå¼€å§‹è¿åŠ¨åˆ°è®¾å®šçš„ç›®æ ‡ä½ç½®
- **åœæ­¢**ï¼šç«‹å³åœæ­¢å½“å‰è¿åŠ¨
- **å½’é›¶**ï¼šå°†æ‰€æœ‰ç›®æ ‡è§’åº¦è®¾ç½®ä¸º0Â°

### çŠ¶æ€æŒ‡ç¤º

å³ä¸‹è§’çŠ¶æ€æ ‡ç­¾æ˜¾ç¤ºå½“å‰çŠ¶æ€ï¼š
- ðŸŸ¢ **å°±ç»ª**ï¼šç­‰å¾…æ‰§è¡ŒæŒ‡ä»¤
- ðŸŸ  **è¿åŠ¨ä¸­...**ï¼šæ­£åœ¨æ‰§è¡Œè¿åŠ¨
- ðŸ”´ **å·²åœæ­¢**ï¼šè¿åŠ¨è¢«æ‰‹åŠ¨åœæ­¢
- ðŸ”´ **ç­‰å¾…å®žæ—¶æ•°æ®...**ï¼šå°šæœªæ”¶åˆ°Isaac Simçš„æ•°æ®
- ðŸŸ¢ **å®Œæˆ**ï¼šè¿åŠ¨æ‰§è¡Œå®Œæ¯•

## å…³èŠ‚é™ä½

æ‰€æœ‰å…³èŠ‚éƒ½æœ‰å®‰å…¨é™ä½ä¿æŠ¤ï¼Œè¯¦ç»†é™ä½å‚è§ `triarm_control/joint_names.py`ï¼š

### å¹³å°å…³èŠ‚
- **D1**ï¼š-180Â° ~ +180Â°

### æœºæ¢°è‡‚A
- **A1**ï¼š-180Â° ~ +180Â°
- **A2**ï¼š-129.5Â° ~ +129.5Â°
- **A3**ï¼š-129.5Â° ~ +129.5Â°
- **A4**ï¼š-180Â° ~ +180Â°
- **A5**ï¼š-126Â° ~ +126Â°
- **A6**ï¼š-355Â° ~ +355Â°

### æœºæ¢°è‡‚B
- **B1**ï¼š-180Â° ~ +180Â°
- **B2**ï¼š-129.5Â° ~ +129.5Â°
- **B3**ï¼š-129.5Â° ~ +129.5Â°
- **B4**ï¼š-180Â° ~ +180Â°
- **B5**ï¼š-126Â° ~ +126Â°
- **B6**ï¼š-355Â° ~ +355Â°

### æœºæ¢°è‡‚S
- **S1**ï¼š-153.6Â° ~ +153.6Â°
- **S2**ï¼š0Â° ~ +189Â°
- **S3**ï¼š0Â° ~ +180Â°
- **S4**ï¼š-88.8Â° ~ +88.8Â°
- **S5**ï¼š-88.8Â° ~ +88.8Â°
- **S6**ï¼š-171.9Â° ~ +171.9Â°

## è¿åŠ¨æŽ§åˆ¶ç®—æ³•

### æ’å€¼è¿åŠ¨

ç³»ç»Ÿé‡‡ç”¨é€Ÿåº¦é™åˆ¶çš„çº¿æ€§æ’å€¼ç®—æ³•ï¼š

1. è®¡ç®—æ¯ä¸ªæŽ§åˆ¶å‘¨æœŸçš„æœ€å¤§è§’åº¦å˜åŒ–é‡ï¼š
   ```
   max_delta = joint_velocity * dt
   ```

2. å¯¹æ¯ä¸ªå…³èŠ‚è¿›è¡Œæ’å€¼ï¼š
   ```python
   diff = target_position - current_command
   if abs(diff) > max_delta:
       diff = max_delta * sign(diff)
   current_command += diff
   ```

3. å½“æ‰€æœ‰å…³èŠ‚è¯¯å·® < 0.001 rad (â‰ˆ0.06Â°) æ—¶ï¼Œè®¤ä¸ºåˆ°è¾¾ç›®æ ‡

### å®‰å…¨ç‰¹æ€§

- âœ… å…³èŠ‚é™ä½å¼ºåˆ¶æ‰§è¡Œ
- âœ… é€Ÿåº¦é™åˆ¶é˜²æ­¢çªå˜
- âœ… çŠ¶æ€éªŒè¯ï¼ˆç­‰å¾…å®žæ—¶æ•°æ®åŽæ‰å…è®¸è¿åŠ¨ï¼‰
- âœ… å…³èŠ‚åç§°åŒ¹é…ï¼ˆé¿å…æ•°æ®é”™ä½ï¼‰

## æ–‡ä»¶ç»“æž„

```
triarm_control/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ triarm_config.yaml          # é…ç½®å‚æ•°
â”œâ”€â”€ launch/
â”‚   â””â”€â”€ triarm_control.launch.py    # ROS2å¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ triarm_control/                 # PythonåŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ joint_names.py              # å…³èŠ‚å®šä¹‰å’Œé™ä½
â”‚   â””â”€â”€ joint_control_gui.py        # ä¸»GUIèŠ‚ç‚¹
â”œâ”€â”€ resource/
â”‚   â””â”€â”€ triarm_control              # ROS2èµ„æºæ ‡è®°
â”œâ”€â”€ package.xml                     # ROS2åŒ…æ¸…å•
â”œâ”€â”€ setup.cfg                       # Pythoné…ç½®
â”œâ”€â”€ setup.py                        # PythonåŒ…å®‰è£…
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£
```

## å¸¸è§é—®é¢˜

### Q1: GUIæ— æ³•å¯åŠ¨ï¼Œæç¤º"éœ€è¦å®‰è£…tkinter"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
sudo apt-get install python3-tk
```

### Q2: è“è‰²å®žæ—¶å€¼æ˜¾ç¤º"--"æˆ–ä¸æ›´æ–°

**åŽŸå› **ï¼šæœªæ”¶åˆ°Isaac Simå‘å¸ƒçš„ `/joint_states` æ¶ˆæ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥Isaac Simæ˜¯å¦æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥è¯é¢˜æ˜¯å¦æ­£ç¡®ï¼š`ros2 topic list | grep joint_states`
3. æ£€æŸ¥è¯é¢˜æ•°æ®ï¼š`ros2 topic echo /joint_states`

### Q3: ç‚¹å‡»"æ‰§è¡Œ"åŽæœºæ¢°è‡‚é‡åŠ¨

**åŽŸå› **ï¼šå·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä¿®å¤ï¼ˆä½¿ç”¨ `is_initialized` æ ‡å¿—ï¼‰

**è¯´æ˜Ž**ï¼šçŽ°åœ¨åªåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ä»Žå®žæ—¶ä½ç½®åˆå§‹åŒ–ï¼ŒåŽç»­æ‰§è¡Œä»Žä¸Šæ¬¡æŒ‡ä»¤ä½ç½®ç»§ç»­

### Q4: è“è‰²æ•°å€¼èŽ«åå…¶å¦™"å½’é›¶"

**åŽŸå› **ï¼šå·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä¿®å¤ï¼ˆä½¿ç”¨å…³èŠ‚åç§°åŒ¹é…ï¼‰

**è¯´æ˜Ž**ï¼šçŽ°åœ¨æŒ‰å…³èŠ‚åç§°åŒ¹é…æ•°æ®ï¼Œé¿å…é¡ºåºé”™ä¹±å¯¼è‡´çš„æ•°æ®é”™ä½

### Q5: å¦‚ä½•è°ƒæ•´è¿åŠ¨é€Ÿåº¦ï¼Ÿ

**æ–¹æ³•1**ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ `config/triarm_config.yaml`
```yaml
joint_velocity: 45.0  # æ”¹ä¸ºæ›´å¤§çš„å€¼ï¼ˆåº¦/ç§’ï¼‰
```

**æ–¹æ³•2**ï¼šå¯åŠ¨æ—¶ä¼ é€’å‚æ•°
```bash
ros2 run triarm_control joint_gui --ros-args -p joint_velocity:=60.0
```

## å¼€å‘è¯´æ˜Ž

### æ·»åŠ æ–°å…³èŠ‚

1. åœ¨ `joint_names.py` ä¸­æ·»åŠ å…³èŠ‚åç§°åˆ° `JOINT_NAMES_LIST`
2. åœ¨ `JOINT_LIMITS` ä¸­æ·»åŠ å¯¹åº”çš„é™ä½
3. æ›´æ–° GUI åˆ›å»ºé€»è¾‘ï¼ˆå¦‚éœ€è¦æ–°çš„æ ‡ç­¾é¡µï¼‰

### ä¿®æ”¹GUIå¸ƒå±€

ä¸»è¦æ–¹æ³•ï¼š
- `_create_gui()`ï¼šåˆ›å»ºä¸»çª—å£å’Œæ ‡ç­¾é¡µ
- `_add_header_row()`ï¼šæ·»åŠ è¡¨å¤´
- `_add_joint_row()`ï¼šæ·»åŠ å…³èŠ‚æŽ§åˆ¶è¡Œ

### è°ƒè¯•æŠ€å·§

æŸ¥çœ‹ROS2æ—¥å¿—ï¼š
```bash
ros2 run triarm_control joint_gui --ros-args --log-level debug
```

ç›‘æŽ§è¯é¢˜é€šä¿¡ï¼š
```bash
# æŸ¥çœ‹å®žæ—¶çŠ¶æ€
ros2 topic echo /joint_states

# æŸ¥çœ‹å‘é€çš„æŒ‡ä»¤
ros2 topic echo /joint_command

# æŸ¥çœ‹è¯é¢˜é¢‘çŽ‡
ros2 topic hz /joint_command
```

## ç‰ˆæœ¬åŽ†å²

### v0.1.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒ19å…³èŠ‚æŽ§åˆ¶
- âœ… GUIç•Œé¢å®žçŽ°
- âœ… ä¿®å¤æœºæ¢°è‡‚é‡åŠ¨é—®é¢˜
- âœ… ä¿®å¤æ•°æ®å½’é›¶é—®é¢˜
- âœ… æ·»åŠ è¡¨å¤´æ ‡æ³¨

## è®¸å¯è¯

è¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•çš„LICENSEæ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

**æ³¨æ„**ï¼šæœ¬åŠŸèƒ½åŒ…è®¾è®¡ç”¨äºŽä¸ŽIsaac Simä»¿çœŸçŽ¯å¢ƒé…åˆä½¿ç”¨ï¼Œå®žé™…æœºå™¨äººæŽ§åˆ¶éœ€è¦é¢å¤–çš„å®‰å…¨éªŒè¯å’Œæµ‹è¯•ã€‚
